<!DOCTYPE html>
<html>
<head>
	<title>Interactive Canvas</title>
	<script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>

	<script>
	/** Global vars for canvas */
	var output;
	var stageGrid;
	var stageObjs;
	var stageSelector;

	/** Main Canvas Div */
	var canvasDiv      = 'canvasDiv';

	/** Global vars for canvas layers */
	var canvasGrid     = 'CanvasGrid';
	var canvasObjs     = 'CanvasObjs';
	var canvasSelector = 'CanvasSelector';

	/** Global vars for canvas size */
	var canvasWidth  = 800;
	var canvasHeight = 300;

	/** Global var for 'current' selector circle obj */
	var selectorCurrent; 
	
	/** Global var for 'target' selector circle obj */
	var selectorTarget; 


	/**
	 * init()
	 * Setup canvas.
	 */
	function init() {
		//set canvas side using global vars
		setCanvasSize();

		//Create new canvas layers

		//selector stage
		stageSelector = new createjs.Stage(canvasSelector,{transparent:true});

		//grid stage
		stageGrid = new createjs.Stage(canvasGrid,{transparent:true});
		stageGrid.enableDOMEvents(false);

		//objs stage
		stageObjs = new createjs.Stage(canvasObjs,{transparent:true});
		stageObjs.enableDOMEvents(false);


		// For mobile devices.
		createjs.Touch.enable(stageSelector);
		
		// this lets our drag continue to track the mouse even when it leaves the canvas
		stageSelector.mouseMoveOutside = true; 
		

		setupGridStage();
		setupSelectorStage();

	}//\init()
	

	/**
	 * setupSelectorStage()
	 * Function used to setup the stage for current and target selectors
	 */
	function setupSelectorStage(){

		// Selector Current
		// Add circle for current selector obj
		selectorCurrent = new createjs.Shape();
		selectorCurrent.graphics.beginFill("red").drawCircle(0, 0, 20);
		
		var labelCurrent = new createjs.Text("Current", "bold 10px Arial", "#FFFFFF");
		labelCurrent.textAlign = "center";
		labelCurrent.y = -7;
		
		var draggerCurrent = new createjs.Container();
		draggerCurrent.x = draggerCurrent.y = 100;
		draggerCurrent.addChild(selectorCurrent, labelCurrent);
		stageSelector.addChild(draggerCurrent);
		
		draggerCurrent.on("pressmove",function(evt) {
			// currentTarget will be the container that the event listener was added to:
			evt.currentTarget.x = evt.stageX;
			evt.currentTarget.y = evt.stageY;
			// make sure to redraw the stage to show the change:
			stageSelector.update(); 

			showRangeValue('currentAxisValueX',evt.stageX); 				
			showRangeValue('currentAxisValueY',evt.stageY);
		});


		// Selector Target
		// Add circle for Target selector obj
		selectorTarget = new createjs.Shape();
		selectorTarget.graphics.beginFill("blue").drawCircle(0, 0, 20);
		
		var labelTarget = new createjs.Text("Target", "bold 10px Arial", "#FFFFFF");
		labelTarget.textAlign = "center";
		labelTarget.y = -7;
		
		var draggerTarget = new createjs.Container();
		draggerTarget.x = draggerTarget.y = 50;
		draggerTarget.addChild(selectorTarget, labelTarget);
		stageSelector.addChild(draggerTarget);
		
		draggerTarget.on("pressmove",function(evt) {
			// currentTarget will be the container that the event listener was added to:
			evt.currentTarget.x = evt.stageX;
			evt.currentTarget.y = evt.stageY;
			// make sure to redraw the stage to show the change:
			stageSelector.update(); 

			showRangeValue('targetAxisValueX',evt.stageX); 				
			showRangeValue('targetAxisValueY',evt.stageY);
		});		

		stageSelector.update();
	}//\setupSelectorStage()


	/**
	 * setupGridStage()
	 * Function used to setup the stage for the grid display
	 */
	function setupGridStage(){
		//Create Grid for input reference
		var color = '#F3F3F3';

		// Vertical line
		var line = new createjs.Shape();
		line.graphics.setStrokeStyle(3);
		line.graphics.beginStroke(color);
		line.graphics.moveTo(canvasWidth/2,canvasHeight); //start x,y
		line.graphics.lineTo(canvasWidth/2,0);            //end x,y
		line.graphics.endStroke();
		stageGrid.addChild(line);

		// Horizontal line
		var line = new createjs.Shape();
		line.graphics.setStrokeStyle(3);
		line.graphics.beginStroke(color);
		line.graphics.moveTo(0,canvasHeight/2);	          //start x,y
		line.graphics.lineTo(canvasWidth,canvasHeight/2); //end x,y
		line.graphics.endStroke();
		stageGrid.addChild(line);

		// Helper text		
		var offsetX = canvasWidth/10;
		var offsetY = canvasHeight/10;
		// For x dimension
		stageGrid.addChild( new createjs.Text("Low dimen X", "20px Arial", "#ff7700").set({x:(canvasWidth/4)-offsetX,y:(canvasHeight-offsetY)}) );
		stageGrid.addChild( new createjs.Text("High dimen X", "20px Arial", "#ff7700").set({x:(canvasWidth/2+canvasWidth/4)-offsetX,y:(canvasHeight-offsetY)}) );
		// For y dimension
		stageGrid.addChild( new createjs.Text("Low dimen Y", "20px Arial", "#ff7700").set({x:canvasWidth-offsetY,y:(canvasHeight),rotation:-90}) );
		stageGrid.addChild( new createjs.Text("High dimen Y", "20px Arial", "#ff7700").set({x:canvasWidth-offsetY,y:(canvasHeight/2)-offsetY,rotation:-90}) );		

		//update canvas
		stageGrid.update();
	}//\setupGridStage()


	/**
	 * showRangeValue()
	 * Function used to change the display of values on page.
	 * given elementId and value.
	 */
	function showRangeValue(elementId,value){
		document.getElementById(elementId).value = value;
	}


	/**
	 * setCanvasSize()
	 * Update the width and height variables for canvas size.
	 */
	function setCanvasSize(){
		document.getElementById(canvasSelector).width = canvasWidth;
		document.getElementById(canvasSelector).height = canvasHeight;

		document.getElementById(canvasGrid).width = canvasWidth;
		document.getElementById(canvasGrid).height = canvasHeight;

		document.getElementById(canvasObjs).width = canvasWidth;
		document.getElementById(canvasObjs).height = canvasHeight;

		document.getElementById(canvasDiv).style.width = ""+canvasWidth+"px";
		document.getElementById(canvasDiv).style.height = ""+canvasHeight+"px";
	}


	/**
	 * addObjectsToCanvas()
	 * Function used to add object observations (features)
	 * to the feature space (canvas)
	 * As the canvas is two dimensions (x,y) we only add 
	 * two observations (features) to this space for each object.
	 */
	function addObjectsToCanvas(objs){

		//fixed display variables
		var colour = "#ff7700";
		var dotSize = 10;

		//obj variables placeholder
		var name;
		var xVal;
		var yVal;

		for (i in objs) {
		 	//alert( ""+objs[i].name+" x="+objs[i].x+" y="+objs[i].y+"");

			name = objs[i].name;
			xVal = objs[i].x;
			yVal = objs[i].y;

			stageObjs.addChild(new createjs.Shape()).set({x:xVal,y:yVal}).graphics.f(colour).dc(0,0,dotSize);			
		}
		stageObjs.update();		
	}//\addObjectsToCanvas()


	function addObjects(){
		objs = '[{"name":"obj1","x":20,"y":30},{"name":"obj2","x":30,"y":60},{"name":"obj3","x":30,"y":60}]';
		var arr = JSON.parse(objs);
		addObjectsToCanvas(arr);
	}



	</script>

	<style>	
	/* Style for main canvas div */
	#canvasDiv {
	  position: relative;
	  background: none;
	}

	/* Style for canvas layout */
	.canvasStyle {
	  position: absolute;
	  background: none;
	  border: 1px solid grey;
	}
	</style>

</head>
 <body onload="init();">
	
	<div id="canvasDiv">		 
	 <canvas class="canvasStyle" id="CanvasGrid" width="0" height="0"></canvas>
	 <canvas class="canvasStyle" id="CanvasObjs" width="0" height="0"></canvas>
	 <canvas class="canvasStyle" id="CanvasSelector" width="0" height="0"></canvas>	 
	</div>
	
	<div>
	 <p>Current X:<input type="number" class="" value="0" id="currentAxisValueX"> Y:<input type="number" class="" value="0" id="currentAxisValueY"></p>
	 <p>Target  X:<input type="number" class="" value="0" id="targetAxisValueX"> Y:<input type="number" class="" value="0" id="targetAxisValueY"></p>
	 <button onclick="addObjects()">Add Objects</button>	
	</div>	

 </body>
</html>
